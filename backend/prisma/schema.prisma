generator client {
  provider     = "prisma-client-js"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// USER TYPES - Separated into distinct tables
// ============================================================================

model customers {
  customer_id             BigInt               @id @default(autoincrement())
  email                   String               @unique @db.VarChar(255)
  phone                   String               @unique @db.VarChar(20)
  password_hash           String               @db.VarChar(255)
  first_name              String               @db.VarChar(100)
  last_name               String               @db.VarChar(100)
  date_of_birth           DateTime?            @db.Date
  emergency_contact_name  String?              @db.VarChar(100)
  emergency_contact_phone String?              @db.VarChar(20)
  is_active               Boolean?             @default(true)
  is_email_verified       Boolean?             @default(false)
  is_phone_verified       Boolean?             @default(false)
  created_at              DateTime?            @default(now()) @db.Timestamp(6)
  updated_at              DateTime?            @default(now()) @db.Timestamp(6)
  last_login_at           DateTime?            @db.Timestamp(6)
  
  // Relations
  carts                   carts[]
  customer_addresses      customer_addresses[]
  orders                  orders[]
  prescriptions           prescriptions[]
  returns                 returns[]
  customer_notifications  customer_notifications[]
}

model pharmacists {
  pharmacist_id             BigInt                     @id @default(autoincrement())
  email                     String                     @unique @db.VarChar(255)
  phone                     String                     @unique @db.VarChar(20)
  password_hash             String                     @db.VarChar(255)
  first_name                String                     @db.VarChar(100)
  last_name                 String                     @db.VarChar(100)
  date_of_birth             DateTime?                  @db.Date
  pharmacist_role           String                     @default("PHARMACIST") @db.VarChar(50) // PHARMACIST or LEAD_PHARMACIST
  pharmacist_license_number String                     @db.VarChar(100)
  license_state             String                     @db.VarChar(100)
  license_expiry_date       DateTime                   @db.Date
  is_primary                Boolean?                   @default(false)
  is_active                 Boolean?                   @default(true)
  is_email_verified         Boolean?                   @default(false)
  is_phone_verified         Boolean?                   @default(false)
  assigned_by               BigInt?
  assigned_at               DateTime?                  @default(now()) @db.Timestamp(6)
  created_at                DateTime?                  @default(now()) @db.Timestamp(6)
  updated_at                DateTime?                  @default(now()) @db.Timestamp(6)
  last_login_at             DateTime?                  @db.Timestamp(6)
  
  // Relations
  admins                           admins?                    @relation(fields: [assigned_by], references: [admin_id], onDelete: NoAction, onUpdate: NoAction)
  assigned_orders                  orders[]
  verified_prescriptions           prescriptions[]
  purchase_receipts                purchase_receipts[]
  stock_adjustments                stock_adjustments[]
  pharmacist_notifications         pharmacist_notifications[]
}

model admins {
  admin_id          BigInt              @id @default(autoincrement())
  email             String              @unique @db.VarChar(255)
  phone             String?             @unique @db.VarChar(20)
  password_hash     String              @db.VarChar(255)
  first_name        String              @db.VarChar(100)
  last_name         String              @db.VarChar(100)
  admin_level       String?             @default("STANDARD") @db.VarChar(50) 
  is_active         Boolean?            @default(true)
  is_email_verified Boolean?            @default(false)
  is_phone_verified Boolean?            @default(false)
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  updated_at        DateTime?           @default(now()) @db.Timestamp(6)
  last_login_at     DateTime?           @db.Timestamp(6)
  
  // Relations
  assigned_pharmacists    pharmacists[]
  approved_returns        returns[]
  purchase_orders         purchase_orders[]
  system_settings         system_settings[]
  admin_notifications     admin_notifications[]
}

// ============================================================================
// NOTIFICATION TABLES - Separated by user type
// ============================================================================

model customer_notifications {
  notification_id   BigInt    @id @default(autoincrement())
  customer_id       BigInt
  notification_type String    @db.VarChar(50)
  title             String    @db.VarChar(255)
  message           String
  is_read           Boolean?  @default(false)
  read_at           DateTime? @db.Timestamp(6)
  reference_type    String?   @db.VarChar(50)
  reference_id      BigInt?
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  
  customers         customers @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade, onUpdate: NoAction)
}

model pharmacist_notifications {
  notification_id   BigInt       @id @default(autoincrement())
  pharmacist_id     BigInt
  notification_type String       @db.VarChar(50)
  title             String       @db.VarChar(255)
  message           String
  is_read           Boolean?     @default(false)
  read_at           DateTime?    @db.Timestamp(6)
  reference_type    String?      @db.VarChar(50)
  reference_id      BigInt?
  created_at        DateTime?    @default(now()) @db.Timestamp(6)
  
  pharmacists       pharmacists  @relation(fields: [pharmacist_id], references: [pharmacist_id], onDelete: Cascade, onUpdate: NoAction)
}

model admin_notifications {
  notification_id   BigInt    @id @default(autoincrement())
  admin_id          BigInt
  notification_type String    @db.VarChar(50)
  title             String    @db.VarChar(255)
  message           String
  is_read           Boolean?  @default(false)
  read_at           DateTime? @db.Timestamp(6)
  reference_type    String?   @db.VarChar(50)
  reference_id      BigInt?
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  
  admins            admins    @relation(fields: [admin_id], references: [admin_id], onDelete: Cascade, onUpdate: NoAction)
}

// ============================================================================
// PRODUCT & CATALOG TABLES
// ============================================================================

model brands {
  brand_id          Int        @id @default(autoincrement())
  brand_name        String
  origin_country    String?
  manufacturer_name String?
  web_url           String?
  is_active         Boolean?   @default(true)
  products          products[]
}

model categories {
  category_id   Int        @id @default(autoincrement())
  category_name String     @unique @db.VarChar(100)
  description   String?
  products      products[]
}

model hsn_codes {
  hsn_id      Int        @id @default(autoincrement())
  hsn_code    String     @unique @db.VarChar(20)
  description String?
  gst_rate    Decimal    @db.Decimal(5, 2)
  is_active   Boolean?   @default(true)
  products    products[]
}

model products {
  product_id              BigInt                   @id @default(autoincrement())
  product_code            String                   @unique @db.VarChar(100)
  product_name            String                   @db.VarChar(500)
  generic_name            String?                  @db.VarChar(500)
  brand_id                Int?
  category_id             Int
  hsn_id                  Int
  requires_prescription   Boolean?                 @default(false)
  is_otc                  Boolean?                 @default(true)
  is_controlled_substance Boolean?                 @default(false)
  drug_schedule           String?                  @db.VarChar(20)
  dosage_form             String?                  @db.VarChar(100)
  strength                String?                  @db.VarChar(100)
  pack_size               String?                  @db.VarChar(100)
  description             String?
  is_active               Boolean?                 @default(true)
  created_at              DateTime?                @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                @default(now()) @db.Timestamp(6)
  
  // Relations
  brands                  brands?                  @relation(fields: [brand_id], references: [brand_id], onDelete: NoAction, onUpdate: NoAction)
  categories              categories               @relation(fields: [category_id], references: [category_id], onDelete: NoAction, onUpdate: NoAction)
  hsn_codes               hsn_codes                @relation(fields: [hsn_id], references: [hsn_id], onDelete: NoAction, onUpdate: NoAction)
  cart_items              cart_items[]
  order_items             order_items[]
  purchase_order_items    purchase_order_items[]
  purchase_receipt_items  purchase_receipt_items[]
  warehouse_inventory     warehouse_inventory[]
}

// ============================================================================
// CUSTOMER-FACING TABLES
// ============================================================================

model customer_addresses {
  address_id                                            BigInt     @id @default(autoincrement())
  customer_id                                           BigInt
  address_type                                          String     @db.VarChar(20)
  is_default                                            Boolean?   @default(false)
  address_line1                                         String     @db.VarChar(255)
  address_line2                                         String?    @db.VarChar(255)
  city                                                  String     @db.VarChar(100)
  state                                                 String     @db.VarChar(100)
  postal_code                                           String     @db.VarChar(20)
  country                                               String     @default("India") @db.VarChar(100)
  latitude                                              Decimal?   @db.Decimal(10, 8)
  longitude                                             Decimal?   @db.Decimal(11, 8)
  created_at                                            DateTime?  @default(now()) @db.Timestamp(6)
  updated_at                                            DateTime?  @default(now()) @db.Timestamp(6)
  
  customers                                             customers  @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade, onUpdate: NoAction)
  orders_billing_address                                orders[]   @relation("orders_billing_address")
  orders_shipping_address                               orders[]   @relation("orders_shipping_address")
}

model carts {
  cart_id     BigInt       @id @default(autoincrement())
  customer_id BigInt
  created_at  DateTime?    @default(now()) @db.Timestamp(6)
  updated_at  DateTime?    @default(now()) @db.Timestamp(6)
  
  customers   customers    @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade, onUpdate: NoAction)
  cart_items  cart_items[]
}

model cart_items {
  cart_item_id BigInt    @id @default(autoincrement())
  cart_id      BigInt
  product_id   BigInt
  quantity     Int
  added_at     DateTime? @default(now()) @db.Timestamp(6)
  
  carts        carts     @relation(fields: [cart_id], references: [cart_id], onDelete: Cascade, onUpdate: NoAction)
  products     products  @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([cart_id, product_id])
}

// ============================================================================
// PRESCRIPTION TABLES - Simplified (order-level, no prescription_items)
// ============================================================================

model prescriptions {
  prescription_id        BigInt                   @id @default(autoincrement())
  order_id               BigInt                   @unique
  customer_id            BigInt
  uploaded_at            DateTime?                @default(now()) @db.Timestamp(6)
  status                 String?                  @default("PENDING") @db.VarChar(50)
  verified_by            BigInt?
  verified_at            DateTime?                @db.Timestamp(6)
  rejection_reason       String?
  pharmacist_notes       String?
  created_at             DateTime?                @default(now()) @db.Timestamp(6)
  
  customers              customers                @relation(fields: [customer_id], references: [customer_id], onDelete: NoAction, onUpdate: NoAction)
  orders                 orders                   @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  pharmacists            pharmacists?             @relation(fields: [verified_by], references: [pharmacist_id], onDelete: NoAction, onUpdate: NoAction)
  prescription_documents prescription_documents[]
}

model prescription_documents {
  document_id     BigInt        @id @default(autoincrement())
  prescription_id BigInt
  document_path   String        @db.VarChar(500)
  document_type   String        @default("application/pdf") @db.VarChar(50)
  file_size_kb    Int?
  uploaded_at     DateTime?     @default(now()) @db.Timestamp(6)
  
  prescriptions   prescriptions @relation(fields: [prescription_id], references: [prescription_id], onDelete: Cascade, onUpdate: NoAction)
}

// ============================================================================
// ORDER TABLES
// ============================================================================

model orders {
  order_id               BigInt             @id @default(autoincrement())
  order_number           String             @unique @db.VarChar(100)
  customer_id            BigInt
  warehouse_id           Int?
  order_date             DateTime?          @default(now()) @db.Timestamp(6)
  order_type             String             @db.VarChar(50)
  requires_prescription  Boolean            @default(false)
  status                 String             @default("PENDING") @db.VarChar(50)
  shipping_address_id    BigInt
  billing_address_id     BigInt
  subtotal               Decimal            @db.Decimal(12, 2)
  tax_amount             Decimal            @db.Decimal(12, 2)
  shipping_charges       Decimal?           @default(0) @db.Decimal(10, 2)
  discount_amount        Decimal?           @default(0) @db.Decimal(10, 2)
  total_amount           Decimal            @db.Decimal(12, 2)
  payment_status         String?            @default("PENDING") @db.VarChar(50)
  assigned_pharmacist_id BigInt?
  assigned_at            DateTime?          @db.Timestamp(6)
  processed_at           DateTime?          @db.Timestamp(6)
  shipped_at             DateTime?          @db.Timestamp(6)
  delivered_at           DateTime?          @db.Timestamp(6)
  cancelled_at           DateTime?          @db.Timestamp(6)
  cancellation_reason    String?
  special_instructions   String?
  created_at             DateTime?          @default(now()) @db.Timestamp(6)
  updated_at             DateTime?          @default(now()) @db.Timestamp(6)
  
  customers              customers          @relation(fields: [customer_id], references: [customer_id], onDelete: NoAction, onUpdate: NoAction)
  pharmacists            pharmacists?       @relation(fields: [assigned_pharmacist_id], references: [pharmacist_id], onDelete: NoAction, onUpdate: NoAction)
  billing_address        customer_addresses @relation("orders_billing_address", fields: [billing_address_id], references: [address_id], onDelete: NoAction, onUpdate: NoAction)
  shipping_address       customer_addresses @relation("orders_shipping_address", fields: [shipping_address_id], references: [address_id], onDelete: NoAction, onUpdate: NoAction)
  warehouses             warehouses?        @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  prescription           prescriptions?
  order_items            order_items[]
  payments               payments[]
  returns                returns[]
  shipments              shipments[]
}

model order_items {
  order_item_id        BigInt               @id @default(autoincrement())
  order_id             BigInt
  product_id           BigInt
  inventory_id         BigInt?
  quantity             Int
  unit_price           Decimal              @db.Decimal(10, 2)
  mrp                  Decimal              @db.Decimal(10, 2)
  discount_percent     Decimal?             @default(0) @db.Decimal(5, 2)
  tax_rate             Decimal              @db.Decimal(5, 2)
  tax_amount           Decimal              @db.Decimal(10, 2)
  total_amount         Decimal              @db.Decimal(10, 2)
  status               String?              @default("PENDING") @db.VarChar(50)
  
  orders               orders               @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  products             products             @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction)
  warehouse_inventory  warehouse_inventory? @relation(fields: [inventory_id], references: [inventory_id], onDelete: NoAction, onUpdate: NoAction)
  return_items         return_items[]
}

model payments {
  payment_id       BigInt    @id @default(autoincrement())
  order_id         BigInt
  payment_method   String    @db.VarChar(50)
  payment_gateway  String?   @db.VarChar(50)
  transaction_id   String?   @unique @db.VarChar(255)
  amount           Decimal   @db.Decimal(12, 2)
  currency         String?   @default("INR") @db.VarChar(3)
  status           String    @default("PENDING") @db.VarChar(50)
  payment_date     DateTime? @default(now()) @db.Timestamp(6)
  refund_amount    Decimal?  @default(0) @db.Decimal(12, 2)
  refund_date      DateTime? @db.Timestamp(6)
  gateway_response String?
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  
  orders           orders    @relation(fields: [order_id], references: [order_id], onDelete: NoAction, onUpdate: NoAction)
}

model shipments {
  shipment_id             BigInt    @id @default(autoincrement())
  order_id                BigInt
  shipped_date            DateTime? @db.Timestamp(6)
  delivery_date           DateTime? @db.Timestamp(6)
  delivery_status         String?   @default("PENDING") @db.VarChar(50)
  delivered_to            String?   @db.VarChar(255)
  delivery_signature_path String?   @db.VarChar(500)
  created_at              DateTime? @default(now()) @db.Timestamp(6)
  updated_at              DateTime? @default(now()) @db.Timestamp(6)
  
  orders                  orders    @relation(fields: [order_id], references: [order_id], onDelete: NoAction, onUpdate: NoAction)
}

// ============================================================================
// RETURNS TABLES
// ============================================================================

model returns {
  return_id          BigInt         @id @default(autoincrement())
  return_number      String         @unique @db.VarChar(100)
  order_id           BigInt
  customer_id        BigInt
  return_reason      String         @db.VarChar(50)
  return_description String?
  status             String?        @default("REQUESTED") @db.VarChar(50)
  requested_at       DateTime?      @default(now()) @db.Timestamp(6)
  approved_at        DateTime?      @db.Timestamp(6)
  approved_by        BigInt?
  received_at        DateTime?      @db.Timestamp(6)
  refund_amount      Decimal?       @db.Decimal(10, 2)
  refund_method      String?        @db.VarChar(50)
  refunded_at        DateTime?      @db.Timestamp(6)
  rejection_reason   String?
  
  customers          customers      @relation(fields: [customer_id], references: [customer_id], onDelete: NoAction, onUpdate: NoAction)
  orders             orders         @relation(fields: [order_id], references: [order_id], onDelete: NoAction, onUpdate: NoAction)
  admins             admins?        @relation(fields: [approved_by], references: [admin_id], onDelete: NoAction, onUpdate: NoAction)
  return_items       return_items[]
}

model return_items {
  return_item_id BigInt      @id @default(autoincrement())
  return_id      BigInt
  order_item_id  BigInt
  quantity       Int
  condition      String?     @db.VarChar(50)
  
  returns        returns     @relation(fields: [return_id], references: [return_id], onDelete: Cascade, onUpdate: NoAction)
  order_items    order_items @relation(fields: [order_item_id], references: [order_item_id], onDelete: NoAction, onUpdate: NoAction)
}

// ============================================================================
// WAREHOUSE & INVENTORY TABLES
// ============================================================================

model warehouses {
  warehouse_id            Int                       @id @default(autoincrement())
  warehouse_name          String                    @db.VarChar(255)
  address_line1           String                    @db.VarChar(255)
  address_line2           String?                   @db.VarChar(255)
  city                    String                    @db.VarChar(100)
  state                   String                    @db.VarChar(100)
  postal_code             String                    @db.VarChar(20)
  latitude                Decimal                   @db.Decimal(10, 8)
  longitude               Decimal                   @db.Decimal(11, 8)
  phone                   String?                   @db.VarChar(20)
  email                   String?                   @db.VarChar(255)
  is_active               Boolean?                  @default(true)
  operating_hours_start   DateTime?                 @db.Time(6)
  operating_hours_end     DateTime?                 @db.Time(6)
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                 @default(now()) @db.Timestamp(6)
  
  orders                  orders[]
  purchase_orders         purchase_orders[]
  purchase_receipts       purchase_receipts[]
  warehouse_inventory     warehouse_inventory[]
  warehouse_service_areas warehouse_service_areas[]
}

model warehouse_service_areas {
  service_area_id         Int        @id @default(autoincrement())
  warehouse_id            Int
  postal_code             String     @db.VarChar(20)
  city                    String?    @db.VarChar(100)
  state                   String?    @db.VarChar(100)
  estimated_delivery_days Int?       @default(3)
  is_serviceable          Boolean?   @default(true)
  
  warehouses              warehouses @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([warehouse_id, postal_code])
}

model warehouse_inventory {
  inventory_id        BigInt              @id @default(autoincrement())
  warehouse_id        Int
  product_id          BigInt
  batch_number        String              @db.VarChar(100)
  vendor_id           Int?
  manufacturing_date  DateTime?           @db.Date
  expiry_date         DateTime            @db.Date
  purchase_price      Decimal             @db.Decimal(10, 2)
  mrp                 Decimal             @db.Decimal(10, 2)
  selling_price       Decimal             @db.Decimal(10, 2)
  quantity_available  Int                 @default(0)
  minimum_stock_level Int?                @default(10)
  rack_location       String?             @db.VarChar(50)
  received_date       DateTime            @db.Date
  last_stock_update   DateTime?           @default(now()) @db.Timestamp(6)
  is_damaged          Boolean?            @default(false)
  notes               String?
  
  products            products            @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction)
  vendors             vendors?            @relation(fields: [vendor_id], references: [vendor_id], onDelete: NoAction, onUpdate: NoAction)
  warehouses          warehouses          @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  order_items         order_items[]
  stock_adjustments   stock_adjustments[]

  @@unique([warehouse_id, product_id, batch_number])
}

model stock_adjustments {
  adjustment_id       BigInt              @id @default(autoincrement())
  inventory_id        BigInt
  adjustment_type     String              @db.VarChar(50)
  quantity_change     Int
  quantity_before     Int
  quantity_after      Int
  reason              String?
  adjusted_by         BigInt
  adjusted_at         DateTime?           @default(now()) @db.Timestamp(6)
  reference_type      String?             @db.VarChar(50)
  reference_id        BigInt?
  
  warehouse_inventory warehouse_inventory @relation(fields: [inventory_id], references: [inventory_id], onDelete: NoAction, onUpdate: NoAction)
  pharmacists         pharmacists         @relation(fields: [adjusted_by], references: [pharmacist_id], onDelete: NoAction, onUpdate: NoAction)
}

// ============================================================================
// VENDOR & PROCUREMENT TABLES
// ============================================================================

model vendors {
  vendor_id           Int                   @id @default(autoincrement())
  vendor_code         String                @unique @db.VarChar(50)
  vendor_name         String                @db.VarChar(255)
  contact_person      String?               @db.VarChar(100)
  email               String?               @db.VarChar(255)
  phone               String?               @db.VarChar(20)
  address_line1       String?               @db.VarChar(255)
  address_line2       String?               @db.VarChar(255)
  city                String?               @db.VarChar(100)
  state               String?               @db.VarChar(100)
  postal_code         String?               @db.VarChar(20)
  gstin               String?               @db.VarChar(15)
  pan                 String?               @db.VarChar(10)
  payment_terms       String?               @db.VarChar(100)
  is_active           Boolean?              @default(true)
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @db.Timestamp(6)
  
  purchase_orders     purchase_orders[]
  warehouse_inventory warehouse_inventory[]
}

model purchase_orders {
  po_id                  BigInt                 @id @default(autoincrement())
  po_number              String                 @unique @db.VarChar(100)
  warehouse_id           Int
  vendor_id              Int
  po_date                DateTime               @default(dbgenerated("CURRENT_DATE")) @db.Date
  expected_delivery_date DateTime?              @db.Date
  status                 String                 @default("DRAFT") @db.VarChar(50)
  subtotal               Decimal                @db.Decimal(12, 2)
  tax_amount             Decimal                @db.Decimal(12, 2)
  total_amount           Decimal                @db.Decimal(12, 2)
  payment_terms          String?                @db.VarChar(100)
  notes                  String?
  created_by             BigInt
  created_at             DateTime?              @default(now()) @db.Timestamp(6)
  updated_at             DateTime?              @default(now()) @db.Timestamp(6)
  
  admins                 admins                 @relation(fields: [created_by], references: [admin_id], onDelete: NoAction, onUpdate: NoAction)
  vendors                vendors                @relation(fields: [vendor_id], references: [vendor_id], onDelete: NoAction, onUpdate: NoAction)
  warehouses             warehouses             @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  purchase_order_items   purchase_order_items[]
  purchase_receipts      purchase_receipts[]
}

model purchase_order_items {
  po_item_id             BigInt                   @id @default(autoincrement())
  po_id                  BigInt
  product_id             BigInt
  quantity_ordered       Int
  quantity_received      Int?                     @default(0)
  unit_price             Decimal                  @db.Decimal(10, 2)
  tax_rate               Decimal                  @db.Decimal(5, 2)
  tax_amount             Decimal                  @db.Decimal(10, 2)
  total_amount           Decimal                  @db.Decimal(10, 2)
  
  purchase_orders        purchase_orders          @relation(fields: [po_id], references: [po_id], onDelete: Cascade, onUpdate: NoAction)
  products               products                 @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction)
  purchase_receipt_items purchase_receipt_items[]
}

model purchase_receipts {
  receipt_id             BigInt                   @id @default(autoincrement())
  po_id                  BigInt
  receipt_number         String                   @unique @db.VarChar(100)
  warehouse_id           Int
  received_date          DateTime                 @default(dbgenerated("CURRENT_DATE")) @db.Date
  received_by            BigInt
  invoice_number         String?                  @db.VarChar(100)
  invoice_date           DateTime?                @db.Date
  notes                  String?
  created_at             DateTime?                @default(now()) @db.Timestamp(6)
  
  purchase_orders        purchase_orders          @relation(fields: [po_id], references: [po_id], onDelete: NoAction, onUpdate: NoAction)
  pharmacists            pharmacists              @relation(fields: [received_by], references: [pharmacist_id], onDelete: NoAction, onUpdate: NoAction)
  warehouses             warehouses               @relation(fields: [warehouse_id], references: [warehouse_id], onDelete: NoAction, onUpdate: NoAction)
  purchase_receipt_items purchase_receipt_items[]
}

model purchase_receipt_items {
  receipt_item_id      BigInt               @id @default(autoincrement())
  receipt_id           BigInt
  po_item_id           BigInt
  product_id           BigInt
  batch_number         String               @db.VarChar(100)
  quantity_received    Int
  manufacturing_date   DateTime?            @db.Date
  expiry_date          DateTime             @db.Date
  unit_price           Decimal              @db.Decimal(10, 2)
  mrp                  Decimal              @db.Decimal(10, 2)
  
  purchase_receipts    purchase_receipts    @relation(fields: [receipt_id], references: [receipt_id], onDelete: Cascade, onUpdate: NoAction)
  purchase_order_items purchase_order_items @relation(fields: [po_item_id], references: [po_item_id], onDelete: NoAction, onUpdate: NoAction)
  products             products             @relation(fields: [product_id], references: [product_id], onDelete: NoAction, onUpdate: NoAction)
}

// ============================================================================
// SYSTEM TABLES
// ============================================================================

model system_settings {
  setting_id    Int       @id @default(autoincrement())
  setting_key   String    @unique @db.VarChar(100)
  setting_value String
  setting_type  String    @db.VarChar(50)
  description   String?
  updated_by    BigInt?
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  
  admins        admins?   @relation(fields: [updated_by], references: [admin_id], onDelete: NoAction, onUpdate: NoAction)
}
